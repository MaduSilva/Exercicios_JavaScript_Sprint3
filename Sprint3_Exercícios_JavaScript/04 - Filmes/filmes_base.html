<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Filmes</title>
</head>
<body>
    
    <form id="form">
        <input type="text" id="nome" placeholder="Nome do filme" required>
        <input type="text" id="categoria" placeholder="Categoria" required>
        <input type="text" id="ano" placeholder="Ano de lançamento" required>

        <button type="button" onclick="Cadastrar()" id="btnCadastrar">Cadastrar</button>
        <button type="button" onclick="remover()" id="btnRemover">Remover</button>

        <table>
            <caption>Filmes</caption>
            <thead>
                <th>
                    Id
                </th>
                <th>
                    Nome
                </th>
                <th>
                    Categoria
                </th>
                <th>
                    Ano Lançamento
                </th>
            </thead>
            <tbody id="tabela-lista-corpo"></tbody>
        </table>
    </form>

</body>
<script>
    let url = 'https://5f90969de0559c0016ad6b27.mockapi.io/categorias';
    let categoria = document.querySelector('#categoria');
    let categorias = [];

    function listar(){
      let xhrGet = new XMLHttpRequest();
      xhrGet.onload = listarSucesso;
      xhrGet.onerror = listarErro;
      xhrGet.open('GET', url);
      xhrGet.send();

    }

    function listarSucesso(){
      console.log('Sucesso');
      const data = this.responseText;
      categorias = JSON.parse(data);
      console.log(categorias);
    }

    function listarErro(err){
      console.error(err)
    }

    function Cadastrar(){
      event.preventDefault();

      let xhrPost = new XMLHttpRequest();
      xhrPost.onload = cadastroSucesso;
      xhrPost.onerror = cadastroErro;
      xhrPost.open('POST', url);
      xhrPost.setRequestHeader('content-type', 'aplicattion/json');

      let paramns = {
        name: categoria.value
      }
      xhrPost.send(JSON.stringify(paramns));
    }

    function cadastroSucesso(){
      console.log('Sucesso');
      console.log(this.status)
      console.log(JSON.parse(this.responseText));

      listar();
    }

    function cadastroErro(err){
      console.log('Erro' + err);
    }

    function remover(){
      let xhrDelete = new XMLHttpRequest();
      xhrDelete.onload = removeSucesso;
      xhrDelete.onerror = removeErro;
      xhrDelete.open('DELETE', url + '/' + categoria.value);
      xhrDelete.send();

    }

    function removeSucesso(){
      console.log('Sucesso');
      console.log(this.status)
      console.log(JSON.parse(this.responseText));

      listar();
    }

    function removeErro(err){
      console.log('Erro' + err);
    }

    
</script>
</html>